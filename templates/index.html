<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>X·∫øp L·ªãch Thi - H·ªá th·ªëng t·ª± ƒë·ªông</title>
    <link rel="stylesheet" href="/static/style.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="logo">
                <span class="logo-icon">üìÖ</span>
                <h1>X·∫øp L·ªãch Thi</h1>
            </div>
            <p class="subtitle">H·ªá th·ªëng x·∫øp l·ªãch thi t·ª± ƒë·ªông v·ªõi OR-Tools</p>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Step 1: Upload Files -->
            <section class="card" id="upload-section">
                <div class="card-header">
                    <span class="step-badge">1</span>
                    <h2>T·∫£i l√™n d·ªØ li·ªáu</h2>
                </div>
                <div class="card-body">
                    <div class="upload-grid">
                        <!-- LHP File -->
                        <div class="upload-item" data-type="lhp">
                            <div class="upload-dropzone" id="drop-lhp">
                                <div class="upload-icon">üìã</div>
                                <div class="upload-label">Danh s√°ch LHP</div>
                                <div class="upload-hint">danhsachLHP.xlsx</div>
                                <div class="upload-status"></div>
                                <input type="file" accept=".xlsx,.xls" hidden>
                            </div>
                        </div>

                        <!-- Data File -->
                        <div class="upload-item" data-type="data">
                            <div class="upload-dropzone" id="drop-data">
                                <div class="upload-icon">üìä</div>
                                <div class="upload-label">Data CTƒêT</div>
                                <div class="upload-hint">Data.xlsx</div>
                                <div class="upload-status"></div>
                                <input type="file" accept=".xlsx,.xls" hidden>
                            </div>
                        </div>

                        <!-- Config File -->
                        <div class="upload-item" data-type="cfg">
                            <div class="upload-dropzone" id="drop-cfg">
                                <div class="upload-icon">‚öôÔ∏è</div>
                                <div class="upload-label">C·∫•u h√¨nh</div>
                                <div class="upload-hint">cau_hinh.xlsx</div>
                                <div class="upload-status"></div>
                                <input type="file" accept=".xlsx,.xls" hidden>
                            </div>
                        </div>

                        <!-- SV File -->
                        <div class="upload-item" data-type="sv">
                            <div class="upload-dropzone" id="drop-sv">
                                <div class="upload-icon">üë•</div>
                                <div class="upload-label">Danh s√°ch SV</div>
                                <div class="upload-hint">danhsachSV.xlsx</div>
                                <div class="upload-status"></div>
                                <input type="file" accept=".xlsx,.xls" hidden>
                            </div>
                        </div>
                    </div>
                </div>
            </section>



            <!-- Step 2: Run Solver -->
            <section class="card" id="solve-section">
                <div class="card-header">
                    <span class="step-badge">2</span>
                    <h2>Ch·∫°y x·∫øp l·ªãch</h2>
                </div>
                <div class="card-body">
                    <div class="solve-actions">
                        <button class="btn btn-primary btn-large" id="btn-solve" disabled>
                            <span class="btn-icon">üöÄ</span>
                            <span class="btn-text">B·∫Øt ƒë·∫ßu x·∫øp l·ªãch</span>
                        </button>
                    </div>

                    <!-- Progress -->
                    <div class="progress-section" id="progress-section" style="display: none;">
                        <div class="progress-bar">
                            <div class="progress-fill" id="progress-fill"></div>
                        </div>
                        <p class="progress-text" id="progress-text">ƒêang x·ª≠ l√Ω...</p>
                    </div>

                    <!-- Result -->
                    <div class="result-section" id="result-section" style="display: none;">
                        <div class="result-header">
                            <span class="result-icon" id="result-icon">‚úÖ</span>
                            <h3 class="result-title" id="result-title">X·∫øp l·ªãch th√†nh c√¥ng!</h3>
                        </div>

                        <div class="result-stats" id="result-stats">
                            <!-- Stats will be inserted here -->
                        </div>

                        <!-- Result Table -->
                        <div class="result-table-container" id="result-table-container" style="display: none;">
                            <div class="table-header">
                                <h4>üìã B·∫£ng l·ªãch thi</h4>
                                <span class="table-info" id="table-info"></span>
                            </div>
                            <div class="table-wrapper">
                                <table class="result-table" id="result-table">
                                    <thead>
                                        <tr>
                                            <th>STT</th>
                                            <th>M√£ HP</th>
                                            <th>T·ªï thi</th>
                                            <th>Ng√†y thi</th>
                                            <th>Ca</th>
                                            <th>Ph√≤ng thi</th>
                                        </tr>
                                    </thead>
                                    <tbody id="result-table-body">
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <div class="result-actions">
                            <button class="btn btn-success" id="btn-download">
                                <span class="btn-icon">üì•</span>
                                <span class="btn-text">T·∫£i k·∫øt qu·∫£ Excel</span>
                            </button>
                            <button class="btn btn-info" id="btn-download-sv" style="display: none;">
                                <span class="btn-icon">üë•</span>
                                <span class="btn-text">T·∫£i DS Sinh vi√™n</span>
                            </button>
                            <button class="btn btn-secondary" id="btn-reset">
                                <span class="btn-icon">üîÑ</span>
                                <span class="btn-text">X·∫øp l·ªãch l·∫°i</span>
                            </button>
                        </div>
                    </div>

                    <!-- Error -->
                    <div class="error-section" id="error-section" style="display: none;">
                        <div class="error-header">
                            <span class="error-icon">‚ùå</span>
                            <h3 class="error-title">Kh√¥ng th·ªÉ x·∫øp l·ªãch</h3>
                        </div>
                        <p class="error-message" id="error-message"></p>
                        <p class="error-hint">üí° Th·ª≠ t·∫Øt r√†ng bu·ªôc "CTƒêT/Kh√≥a kh√¥ng thi li·ªÅn ng√†y" ho·∫∑c tƒÉng s·ªë ng√†y
                            thi.</p>
                    </div>
                </div>
            </section>

            <!-- Step 3: Visual Schedule Visualization -->
            <section class="card" id="visual-section" style="display: none;">
                <div class="card-header">
                    <span class="step-badge">3</span>
                    <h2>Xem & Ch·ªânh s·ª≠a L·ªãch tr·ª±c quan</h2>
                </div>
                <div class="card-body">
                    <div class="visual-controls" style="display: flex; align-items: center; margin-bottom: 15px;">
                        <div class="control-group" style="margin-right: 15px;">
                            <label for="visual-date-select" style="margin-right: 10px;"><strong>Ng√†y
                                    thi:</strong></label>
                            <select id="visual-date-select" class="form-control"
                                style="display: inline-block; width: auto; min-width: 200px;">
                                <option value="">-- Ch·ªçn ng√†y --</option>
                            </select>
                        </div>
                        <button class="btn btn-secondary btn-sm" id="btn-refresh-visual">
                            üîÑ Refresh
                        </button>
                    </div>

                    <!-- Batch Move Controls -->
                    <div class="batch-controls"
                        style="background:#f8f9fa; padding:15px; border-radius:8px; margin-bottom:15px; display:flex; flex-wrap:wrap; gap:15px; align-items:center;">
                        <div style="display:flex; align-items:center; gap:10px;">
                            <label style="color:#000;"><strong>Target Day:</strong></label>
                            <select id="target-day-select" class="form-control" style="width:auto; min-width:180px;">
                                <option value="">-- Select Day --</option>
                            </select>
                        </div>
                        <div style="display:flex; align-items:center; gap:10px;">
                            <label style="color:#000;"><strong>Target Shift:</strong></label>
                            <select id="target-shift-select" class="form-control" style="width:auto; min-width:100px;">
                                <option value="">-- Ca --</option>
                                <option value="1">Ca 1</option>
                                <option value="2">Ca 2</option>
                                <option value="3">Ca 3</option>
                                <option value="4">Ca 4</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" id="btn-batch-move" onclick="batchMoveSelected()" disabled>
                            Move Selected
                        </button>
                        <button class=" btn btn-secondary" onclick="clearAllSelections()">
                            <label style="color:#000;"><strong>Clear Selection</strong></label>
                        </button>
                        <span id="selection-count" style="color:#666; font-weight:bold;">0 selected</span>
                    </div>

                    <div class="schedule-legend" style="margin: 10px 0;">
                        <span class="legend-item"><span class="legend-color occupied"
                                style="background:#e3f2fd; border:1px solid #2196f3; width:15px; height:15px; display:inline-block; vertical-align:middle; margin-right:5px;"></span>Has
                            Exam</span>
                        <span class="legend-item" style="margin-left:15px;"><span class="legend-color empty"
                                style="background:#f5f5f5; border:1px solid #ddd; width:15px; height:15px; display:inline-block; vertical-align:middle; margin-right:5px;"></span>Empty</span>
                        <span class="legend-item" style="margin-left:15px;"><span class="legend-color selected"
                                style="background:#c8e6c9; border:2px solid #4caf50; width:15px; height:15px; display:inline-block; vertical-align:middle; margin-right:5px;"></span>Selected</span>
                    </div>

                    <div class="schedule-grid-wrapper" style="overflow-x: auto;">
                        <div id="schedule-grid" class="schedule-grid">
                            <!-- JS will render grid here -->
                            <p class="text-center text-muted">Vui l√≤ng ch·ªçn ng√†y ƒë·ªÉ xem l·ªãch.</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Previous Results -->
            <section class="card" id="history-section">
                <div class="card-header">
                    <span class="step-badge">üìÅ</span>
                    <h2>L·ªãch s·ª≠ k·∫øt qu·∫£</h2>
                </div>
                <div class="card-body">
                    <div class="results-list" id="results-list">
                        <p class="no-results">Ch∆∞a c√≥ k·∫øt qu·∫£ n√†o</p>
                    </div>
                </div>
            </section>
        </main>

        <!-- Footer -->
        <footer class="footer">
            <p>Powered by Google OR-Tools CP-SAT Solver</p>
        </footer>
    </div>

    <script src="/static/app.js?v=1"></script>
</body>

</html>